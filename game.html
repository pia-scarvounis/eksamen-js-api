<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokemon-game</title>
    <link rel="stylesheet" href="/game.css" />
  </head>
  <body>
    <div class="game-description">
      <h2>Bekjemp Bad Santa</h2>
      <p>
        Trykk på pokemonballen og få hjelp av en tilfeldig pokemon-venn! Trykk
        deretter på din tilfeldige pokemon-venn for å angripe Bad Santa<br />
      </p>
      <p>
        &#128166;<strong>Squirtle attack:</strong> vann<br />
        &#9889; <strong>Pikachu attack:</strong> elektrisitet<br />
        &#128293;<strong>Charmander attack: </strong> ild
      </p>
      <br />
    </div>
    <!-- container pokemon -->
    <div id="stats-container" style="display: none"></div>
    <!--bad santa stats container-->
    <div id="santa-stats-container"></div>
    <!-- bilder fra assets-->
    <img id="pokeball" src="/assets/pokeball.png" alt="pokeball" />
    <img id="pokemon-img" src="" alt="pokemon" style="display: none" />
    <img id="santa-img" src="/assets/santa-claus.png" alt="bad santa" />

    <!--bilder av angreps-effekter: vann, lyn, ild-->
    <div id="attack-effect" style="display: none; position: absolute; z-index: 10;">
        <img id="attack-image" src="">
    </div>

    <script>
      // global variabel for valgt pokemon
      let currentPokemonData = null;

      // pokemonbilde & statscontainers hentes inn
      const pokemonImg = document.getElementById("pokemon-img");
      const statsContainer = document.getElementById("stats-container");
      const santaStatsContainer = document.getElementById(
        "santa-stats-container"
      );
      // async function, fetch data fra API basert på ID.
      async function fetchPokemonStats(id) {
        try {
          const url = `https://pokeapi.co/api/v2/pokemon/${id}/`;
          const response = await fetch(url);
          const pokemonData = await response.json();
          const imgUrl =
            pokemonData.sprites.other["official-artwork"].front_default;
          return {
            name: pokemonData.name,
            image: imgUrl,
            stats: pokemonData.stats,
          };
        } catch (error) {
          console.error("noe er feil, kom tilbake senere", error);
          return null;
        }
      }
      // vise stats i container + styling
      async function displayPokemonStats(pokemonData) {
        currentPokemonData = pokemonData;
        pokemonImg.src = pokemonData.image;
        pokemonImg.style.display = "inline-block";
        pokemonImg.onclick = pokemonAttack;
        statsContainer.innerHTML = "";
        statsContainer.style.display = "block";
        statsContainer.style.backgroundColor = "white";
        statsContainer.style.width = "170px";
        statsContainer.style.margin = "20px";
        statsContainer.style.padding = "30px";
        statsContainer.style.borderRadius = "20px";
        statsContainer.style.fontFamily =
          "'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif";

        // inne i stats container
        const nameElement = document.createElement("h3");
        nameElement.textContent =
          pokemonData.name.charAt(0).toUpperCase() +
          pokemonData.name.slice(1).toLowerCase();
        // lage og legge til elementer for navn, HP, angrep og forsvar
        const hpElement = document.createElement("p");
        hpElement.textContent = "HP: " + pokemonData.stats[0].base_stat;
        const attackElement = document.createElement("p");
        attackElement.textContent = "Attack: " + pokemonData.stats[1].base_stat;
        const defenseElement = document.createElement("p");
        defenseElement.textContent =
          "Defense: " + pokemonData.stats[2].base_stat;

        statsContainer.appendChild(nameElement);
        statsContainer.appendChild(hpElement);
        statsContainer.appendChild(attackElement);
        statsContainer.appendChild(defenseElement);

        // pokemon angrep funksjon:
        function pokemonAttack() {
            let attackImageUrl = '';
            if (currentPokemonData.name.toLowerCase() === "pikachu") {
        attackImageUrl = '/assets/lyn-attack.png'; // lyn
    } else if (currentPokemonData.name.toLowerCase() === "charmander") {
        attackImageUrl = '/assets/fire-attack.png'; // ild
    } else if (currentPokemonData.name.toLowerCase() === "squirtle") {
        attackImageUrl = '/assets/water-attack.png'; // vann
    }
     // attack img vises:
     const attackEffectContainer = document.getElementById("attack-effect");
    const attackImage = document.getElementById("attack-image");
    attackImage.src = attackImageUrl;
    attackImage.style.width = "400px"; 
attackImage.style.height = "auto"; 
    attackEffectContainer.style.display = 'block';

    // alert melding
          alert(`${currentPokemonData.name} angriper Bad Santa med ${currentPokemonData.weapon}!`);
          
        setTimeout(function() {
        attackEffectContainer.style.display = 'none';
    }, 2000); 
    
}}

      // pokemons-array med 3 pokemon
      const pokemons = [
        {
          id: 25,
          img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png",
          weapon: "elektrisitet",
        }, // pikachu
        {
          id: 4,
          img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png",
          weapon: "ild",
        }, // charmander
        {
          id: 7,
          img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png",
          weapon: "vann"
        }, // squirtle
      ];

      // pokeball åpnes når den trykkes på
      let closedPokeball = document.getElementById("pokeball");
      closedPokeball.addEventListener("click", async function () {
        closedPokeball.src = "/assets/open-pokeball.jpg";
        const randomIndex = Math.floor(Math.random() * pokemons.length);
        const selectedPokemon = pokemons[randomIndex];

        const pokemonData = await fetchPokemonStats(selectedPokemon.id);
        currentPokemonData = {
        ...pokemonData, 
        weapon: selectedPokemon.weapon
      };
      pokemonImg.style.display = "block";
        displayPokemonStats(currentPokemonData);});

      // bad santa
      const badSantaStats = {
        name: "Bad Santa",
        hp: 50,
        attack: 50,
        defense: 50,
      };

      function displayBadSantaStats() {
        santaStatsContainer.innerHTML = "";
        santaStatsContainer.style.display = "block";
        santaStatsContainer.style.backgroundColor = "white";
        santaStatsContainer.style.width = "170px";
        santaStatsContainer.style.margin = "20px";
        santaStatsContainer.style.padding = "30px";
        santaStatsContainer.style.borderRadius = "20px";
        santaStatsContainer.style.fontFamily =
          "'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif";

        // nisse navn
        const badSantasName = document.createElement("h3");
        badSantasName.textContent = badSantaStats.name;
        // nisse HP
        const badSantasHp = document.createElement("p");
        badSantasHp.textContent = "HP:" + badSantaStats.hp;
        // nisse attack
        const badSantasAttack = document.createElement("p");
        badSantasAttack.textContent = "Attack:" + badSantaStats.attack;
        // nisse defense
        const badSantasDefense = document.createElement("p");
        badSantasDefense.textContent = "Defense:" + badSantaStats.defense;

        santaStatsContainer.append(
          badSantasName,
          badSantasHp,
          badSantasAttack,
          badSantasDefense
        );
      }
      document.addEventListener("DOMContentLoaded", function () {
        displayBadSantaStats();
      });
    </script>
  </body>
</html>